<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>代扣管理-恒镔代扣平台</title>
<meta name="keywords" content="恒镔代扣平台">
<meta name="description" content="恒镔代扣平台">
<link rel="shortcut icon" href="favicon.ico">
<link href="js/bootstrap/css/bootstrap.min.css" rel="stylesheet">
<link href="js/bootstrap/css/font-awesome.css" rel="stylesheet">
<link href="css/plugins/bootstrap-table/bootstrap-table.min.css"
	rel="stylesheet">
<link
	href="js/bootstrap-datetimepicker/bootstrap-datetimepicker.min.css"
	rel="stylesheet">
<link href="css/style.min.css" rel="stylesheet">
<link href="css/custom.css" rel="stylesheet">
<link href="js/uploadify-v3.1/uploadify.css">
<link rel="stylesheet" href="js/viewer/viewer.min.css">
</head>
<body class="gray-bg">
	<div class="panel-body animated fadeInRight">
		<div class="panel panel-default">
			<form id="formSearch" class="form-horizontal">
				<div class="form-group" style="margin-top: 15px">
					<div class="row col-sm-10">
						<div class="col-sm-4">
							<label class="control-label" for="txt_search_certifyId">身份证：</label>
							<input type="text" class="form-control" id="txt_search_certifyId">
						</div>
						<div class="col-sm-4">
							<label class="control-label" for="txt_search_name">姓名：</label> <input
								type="text" class="form-control" id="txt_search_name">
						</div>
						<div class="col-sm-4">
							<label class="control-label" for="txt_search_mobile">手机号：</label>
							<input type="text" class="form-control" id="txt_search_mobile">
						</div>
					</div>
					<div class="col-sm-2" style="text-align: right;">
						<button type="button" id="btn_query" class="btn btn-primary"
							onclick="javascript:queryEvent('table');">
							<span class="glyphicon glyphicon-search"></span>查询
						</button>
						<button type="button" id="btn_reset" class="btn btn-default"
							onclick="javascript:resetEvent('formSearch');">
							<span class="glyphicon glyphicon-refresh"></span>重置
						</button>
					</div>
				</div>
			</form>

			<!-- start -->
			<div class="ibox float-e-margins">
				<div class="ibox-content">
					<div class="row row-lg">
						<div class="col-sm-12">
							<div id="toolbar">
								<button id="btn_add" type="button" class="btn btn-success"
									data-toggle="modal" data-target="#myModal">
									<span class="glyphicon glyphicon-plus" aria-hidden="true"></span>新增
								</button>
								<!-- <button id="btn_edit" type="button" class="btn btn-danger">
									<span class="glyphicon glyphicon-edit" aria-hidden="true"></span>修改
								</button> -->
							</div>
							<table id="table" style="min-width: 2400px;"></table>
						</div>
					</div>
				</div>
			</div>
			<!-- end  -->

			<!-- model新增 start -->
			<div class="modal fade" id="myModal" tabindex="-1" role="dialog"
				aria-labelledby="myModalLabel" data-backdrop="static"
				data-keyboard="false">
				<div class="modal-dialog" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal"
								aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
							<h4 class="modal-title" id="myModalLabel">代扣管理</h4>
						</div>
						<div class="modal-body">
							<ul class="nav nav-tabs" role="tablist">
								<li role="presentation" class="active"><a>代扣新增</a></li>
							</ul>
							<div class="tab-content">
								<div role="tabpanel" class="tab-pane active" id="home">
									<form action="" id="mercore_form" method="post">
										<div class="row">
											<div class="col-sm-4">
												<label class="control-label" for="legalPerson">姓名：</label>
												<input type="text" class="form-control" id="legalPerson"
													name="legalPerson">
											</div>
											<div class="col-sm-4">
												<label class="control-label" for="legalPersonMobile">手机号码：</label>
												<input type="text" class="form-control"
													id="legalPersonMobile" name="legalPersonMobile">
											</div>
											<div class="col-sm-4">
												<label class="control-label " for="legalValidCardType">证件类型：</label>
												<select id="legalValidCardType" name="legalValidCardType"
													class="form-control">
													<option value="0">身份证</option>
													<option value="1">护照</option>
													<option value="2">士兵证</option>
													<option value="3">军官证</option>
													<option value="4">港澳台通行证</option>
												</select>
											</div>
											<div class="col-sm-4">
												<label class="control-label" for="cardNum">证件号码：</label> <input
													type="text" class="form-control" id="cardNum"
													name="cardNum">
											</div>
											<div class="col-sm-4">
												<label class="control-label" for="cardValidTime">银行卡号：</label>
												<input type="text" class="form-control" id="bankCard"
													name="cardValidTime">
											</div>
											<div class="col-sm-4">
												<label class="control-label" for="businessLicenseNum">扣款金额：</label>
												<input type="text" class="form-control"
													id="businessLicenseNum" name="businessLicenseNum">
											</div>
											<div class="col-sm-4">
												<label class="control-label" for=""debitCount"">扣款次数：</label>
												<input type="number" class="form-control" id="debitCount"
													name=""debitCount"">
											</div>
											<div class="col-sm-4">
												<label class="control-label" for="debitDay">扣款日：</label> <input
													type="number" class="form-control" id="debitDay"
													name="debitDay">
											</div>

											<a class="nextBtn" href="#profile" aria-controls="profile"
												role="tab" data-toggle="tab"
												onclick="javascript:saveMerCore();">保存</a>
										</div>
									</form>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

	</div>
	<script src="js/bootstrap/jquery.min.js"></script>
	<script src="js/bootstrap/js/bootstrap.min.js"></script>
	<script src="js/plugins/bootstrap-table/bootstrap-table.min.js"></script>
	<script src="js/plugins/bootstrap-table/bootstrap-table-mobile.min.js"></script>
	<script src="js/plugins/bootstrap-table/bootstrap-table-export.js"></script>
	<script src="js/plugins/bootstrap-table/tableExport.js"></script>
	<script src="js/plugins/bootstrap-table/tableExport.js"></script>
	<script src="js/plugins/bootstrap-table/bootstrap-table-editable.js"></script>
	<script src="js/plugins/bootstrap-table/bootstrap-editable.js"></script>
	<script src="js/plugins/bootstrap-table/bootstrap-table-zh-CN.min.js"></script>
	<script src="js/viewer/viewer.min.js"></script>
	<script src="js/layer/layer.js"></script>
	<script src="js/uploadify-v3.1/jquery.uploadify.js"></script>
	<script
		src="js/bootstrap-datetimepicker/bootstrap-datetimepicker.min.js"></script>
	<script
		src="js/bootstrap-datetimepicker/bootstrap-datetimepicker.zh-CN.js"></script>
	<script type="js/fnsco/common.js"></script>
	<script src="js/fnsco/withholdList.js"></script>

	<script type="text/javascript">
		//初始化表格
		initTableData();

		function initTableData() {
			$('#table').bootstrapTable({
				sidePagination : 'server',
				search : false, //是否启动搜索栏 
				url : PROJECT_NAME + '/web/withholdInfo/query',
				showRefresh : true,//是否显示刷新按钮
				showPaginationSwitch : false,//是否显示 数据条数选择框(分页是否显示)
				toolbar : '#toolbar', //工具按钮用哪个容器
				striped : true, //是否显示行间隔色
				cache : false, //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
				pagination : true, //是否显示分页（*）
				sortable : true, //是否启用排序
				sortOrder : "asc", //排序方式
				pageNumber : 1, //初始化加载第一页，默认第一页
				pageSize : 15, //每页的记录行数（*）
				pageList : [ 15, 20, 50, 100 ], //可供选择的每页的行数（*）
				queryParams : queryParams,
				responseHandler : responseHandler,//处理服务器返回数据
				columns : [ {
					field : 'id',
					title : '序号'
				}, {
					field : 'userName',
					title : '姓名'
				}, {
					field : 'mobile',
					title : '手机号'
				}, {
					field : 'certifyId',
					title : '身份证号'
				}, {
					field : 'debitDay',
					title : '扣款日'
				}, {
					field : 'amount',
					title : '扣款金额/次'
				}, {
					field : 'amountTotal',
					title : '扣款总额'
				}, {
					field : 'total',
					title : '已扣款次数'
				}, {
					title : '已扣金额',
					formatter : formatPayAmout
				}, {
					title : '待扣金额',
					formatter : formatPayLeft
				}, {
					field : 'bankCard',
					title : '银行卡号',
					formatter : formatPayCard
				}, {
					field : 'modifyUserId',
					title : '提交人'
				}, {
					field : 'modifyTime',
					title : '提交时间'
				}, {
					field : 'status',
					title : '状态',
					formatter : formatStatus
				}, {
					title : '操作',
					align : 'center',
					formatter : operateFormatter
				// events: operateEvents
				} ]
			});
		}

		//组装请求参数
		function queryParams(params) {
			var param = {
				page : this.pageNumber,
				rows : this.pageSize,
				certifyId : $('#txt_search_certifyId').val(),
				name : $('#txt_search_name').val(),
				mobile : $('#txt_search_mobile').val()
			}
			return param;
		}

		//银行卡号格式化前四位和后四位保留，中间*代替
		function formatPayCard(value, row, index) {
			if (!value) {
				return '-';
			} else if (value.length == 0) {
				return '-';
			} else {
				var len = value.length;
				return value.substring(0, 4) + '******'
						+ value.substring(len - 4);
			}
		}

		//状态转换，数字转为字符串说明
		function formatStatus(value, row, index) {
			if (!value) {
				return '-';
			} else if (value == 0) {
				return '终止';
			} else if (value == 1) {
				return '进行中';
			} else if (value == 2) {
				return '完成';
			}
		}

		//已扣金额=已扣次数X扣款金额/次
		function formatPayAmout(value, row, index) {
			return row.total * row.amount;
		}

		//待扣金额
		function formatPayLeft(value, row, index) {
			return row.amountTotal - row.total * row.amount;
		}

		//处理后台返回数据
		//rows一定要精确到数据层
		function responseHandler(res) {
			unloginHandler(res);
			console.log(res);
			if (res) {
				return {
					"rows" : res.data.list,
					"total" : res.data.total
				};
			} else {
				return {
					"rows" : [],
					"total" : 0
				};
			}
		}

		//判断返回码
		function unloginHandler(result) {
			if (result.code && result.code == '4012') {
				layer.msg('登录失效,去登录');
				window.location = "login.html";
			}
		}

		//表格中操作按钮，获取当前唯一标识id
		function operateFormatter(value, row, index) {
			if (row.status == 1) {
				row.status = 1;
				return [
						'<a class="redact" href="javascript:stopData(' + row.id+','+row.status
								+ ');" title="终止">',
						'<i class="glyphicon glyphicon-off"></i>', '</a>' ]
						.join('');
			} else {
				return '';
			}
		}
	</script>
</body>
</html>
