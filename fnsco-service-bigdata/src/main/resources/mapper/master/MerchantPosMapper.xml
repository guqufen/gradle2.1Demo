<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="net.fnsco.order.service.dao.master.MerchantPosDao" >
  <resultMap id="BaseResultMap" type="net.fnsco.order.service.domain.MerchantPos" >
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="inner_code" property="innerCode" jdbcType="VARCHAR" />
    <result column="channel_id" property="channelId" jdbcType="INTEGER" />
    <result column="pos_name" property="posName" jdbcType="VARCHAR" />
    <result column="sn_code" property="snCode" jdbcType="VARCHAR" />
    <result column="pos_factory" property="posFactory" jdbcType="VARCHAR" />
    <result column="pos_type" property="posType" jdbcType="VARCHAR" />
    <result column="status" property="status" jdbcType="VARCHAR" />
    <result column="bank_id" property="bankId" jdbcType="INTEGER" />
    <result column="merc_refer_name" property="mercReferName" jdbcType="VARCHAR" />
  </resultMap>
  <!-- 查询POS所有数据，包括终端信息 -->
  <resultMap id="AllResultMap" type="net.fnsco.order.service.domain.MerchantPos" >
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="inner_code" property="innerCode" jdbcType="VARCHAR" />
    <result column="channel_id" property="channelId" jdbcType="INTEGER" />
    <result column="pos_name" property="posName" jdbcType="VARCHAR" />
    <result column="sn_code" property="snCode" jdbcType="VARCHAR" />
    <result column="pos_factory" property="posFactory" jdbcType="VARCHAR" />
    <result column="pos_type" property="posType" jdbcType="VARCHAR" />
    <result column="status" property="status" jdbcType="VARCHAR" />
    <result column="bank_id" property="bankId" jdbcType="INTEGER" />
    <result column="merc_refer_name" property="mercReferName" jdbcType="VARCHAR" />
    <collection property="terminal" column="id" select="net.fnsco.order.service.dao.master.MerchantTerminalDao.queryAllTerByPosId"/>
  </resultMap>
  <!-- APP商户终端列表结果集 -->
  <resultMap  id="PosResultMap" type="net.fnsco.order.api.dto.PosListDTO">
   	<result column="mer_name" property="merName" jdbcType="VARCHAR" />
   	<collection property="posInfo" column="inner_code" select="net.fnsco.order.service.dao.master.MerchantPosDao.selectPosNamesByInnerCode"/>
  </resultMap>
  <!-- APPPOS详情结果集 -->
  <resultMap id="PosInfoResultMap" type="net.fnsco.order.api.dto.PosDetailDTO" >
    <result column="pos_name" property="posName" jdbcType="VARCHAR" />
    <result column="sn_code" property="snCode" jdbcType="VARCHAR" />
    <result column="pos_factory" property="posFactory" jdbcType="VARCHAR" />
    <result column="pos_type" property="posType" jdbcType="VARCHAR" />
    <collection property="terNames" column="id" select="net.fnsco.order.service.dao.master.MerchantTerminalDao.queryTerByPosId"/>
  </resultMap>
  <sql id="Base_Column_List" >
    id, inner_code, channel_id, pos_name, sn_code, pos_factory, pos_type, status, bank_id, merc_refer_name
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    select 
    <include refid="Base_Column_List" />
    from m_merchant_pos
    where id = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    delete from m_merchant_pos
    where id = #{id,jdbcType=INTEGER}
  </delete>
  
  <insert id="insert" parameterType="net.fnsco.order.service.domain.MerchantPos" >
    insert into m_merchant_pos (id, inner_code, channel_id, 
      pos_name, sn_code, pos_factory, 
      pos_type, status, bank_id, 
      merc_refer_name)
    values (#{id,jdbcType=INTEGER}, #{innerCode,jdbcType=VARCHAR}, #{channelId,jdbcType=INTEGER}, 
      #{posName,jdbcType=VARCHAR}, #{snCode,jdbcType=VARCHAR}, #{posFactory,jdbcType=VARCHAR}, 
      #{posType,jdbcType=VARCHAR}, #{status,jdbcType=VARCHAR}, #{bankId,jdbcType=INTEGER}, 
      #{mercReferName,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="net.fnsco.order.service.domain.MerchantPos" useGeneratedKeys="true" keyProperty="id">
    insert into m_merchant_pos
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="innerCode != null" >
        inner_code,
      </if>
      <if test="channelId != null" >
        channel_id,
      </if>
      <if test="posName != null" >
        pos_name,
      </if>
      <if test="snCode != null" >
        sn_code,
      </if>
      <if test="posFactory != null" >
        pos_factory,
      </if>
      <if test="posType != null" >
        pos_type,
      </if>
      <if test="status != null" >
        status,
      </if>
      <if test="bankId != null" >
        bank_id,
      </if>
      <if test="mercReferName != null" >
        merc_refer_name,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=INTEGER},
      </if>
      <if test="innerCode != null" >
        #{innerCode,jdbcType=VARCHAR},
      </if>
      <if test="channelId != null" >
        #{channelId,jdbcType=INTEGER},
      </if>
      <if test="posName != null" >
        #{posName,jdbcType=VARCHAR},
      </if>
      <if test="snCode != null" >
        #{snCode,jdbcType=VARCHAR},
      </if>
      <if test="posFactory != null" >
        #{posFactory,jdbcType=VARCHAR},
      </if>
      <if test="posType != null" >
        #{posType,jdbcType=VARCHAR},
      </if>
      <if test="status != null" >
        #{status,jdbcType=VARCHAR},
      </if>
      <if test="bankId != null" >
        #{bankId,jdbcType=INTEGER},
      </if>
      <if test="mercReferName != null" >
        #{mercReferName,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>

  <update id="updateByPrimaryKeySelective" parameterType="net.fnsco.order.service.domain.MerchantPos" >
    update m_merchant_pos
    <set >
      <if test="innerCode != null and innerCode != ''" >
        inner_code = #{innerCode,jdbcType=VARCHAR},
      </if>
      <if test="channelId != null" >
        channel_id = #{channelId,jdbcType=INTEGER},
      </if>
      <if test="posName != null and posName != ''" >
        pos_name = #{posName,jdbcType=VARCHAR},
      </if>
      <if test="snCode != null" >
        sn_code = #{snCode,jdbcType=VARCHAR},
      </if>
      <if test="posFactory != null" >
        pos_factory = #{posFactory,jdbcType=VARCHAR},
      </if>
      <if test="posType != null" >
        pos_type = #{posType,jdbcType=VARCHAR},
      </if>
      <if test="status != null" >
        status = #{status,jdbcType=VARCHAR},
      </if>
      <if test="bankId != null" >
        bank_id = #{bankId,jdbcType=INTEGER},
      </if>
      <if test="mercReferName != null" >
        merc_refer_name = #{mercReferName,jdbcType=VARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="net.fnsco.order.service.domain.MerchantPos" >
    update m_merchant_pos
    set inner_code = #{innerCode,jdbcType=VARCHAR},
      channel_id = #{channelId,jdbcType=INTEGER},
      pos_name = #{posName,jdbcType=VARCHAR},
      sn_code = #{snCode,jdbcType=VARCHAR},
      pos_factory = #{posFactory,jdbcType=VARCHAR},
      pos_type = #{posType,jdbcType=VARCHAR},
      status = #{status,jdbcType=VARCHAR},
      bank_id = #{bankId,jdbcType=INTEGER},
      merc_refer_name = #{mercReferName,jdbcType=VARCHAR}
    where id = #{id,jdbcType=INTEGER}
  </update>
  <!-- 根据innercode查询POS名称集合 -->
  <select id="selectPosNamesByInnerCode" parameterType="java.lang.String" resultType="net.fnsco.order.api.dto.PosInfoDTO">
  	SELECT id AS posId,pos_name AS posName FROM m_merchant_pos WHERE inner_code = #{innerCode} AND status = 1
  </select>
  <!-- 根据用户ID 查询所有POS设备信息 -->
  <select id="selectAllPosInfo" parameterType="java.lang.Integer" resultMap="PosResultMap">
    SELECT mer_name,inner_code FROM m_merchant_core WHERE inner_code IN (SELECT inner_code FROM m_merchant_user_rel WHERE app_user_id = #{userId}) AND status = 1
  </select>
  <!-- 根据ID查询详情 -->
  <select id="selectDetailById" parameterType="java.lang.Integer" resultMap="PosInfoResultMap">
     SELECT id,pos_name,pos_factory,pos_type,sn_code  FROM m_merchant_pos WHERE id = #{id} AND status = 1
  </select>
  <!-- 根据channelId删除数据 -->
  <delete id="deleteByChannelId" parameterType="java.lang.Integer">
    delete from m_merchant_pos
      where channel_id = #{channelId,jdbcType=INTEGER}
  </delete>
  <!-- 根据channelId查询所有数据包括终端数据 -->
  <select id="selectByChannelId" parameterType="java.lang.Integer" resultMap="AllResultMap">
    select 
    <include refid="Base_Column_List" />
    from m_merchant_pos
    where channel_id = #{channelId,jdbcType=INTEGER}
  </select>
  <!-- 根据userID查询POS列表 -->
  <select id="selectAllByUserId" parameterType="java.lang.Integer" resultType="net.fnsco.order.api.dto.PosInfoDTO">
    SELECT id AS posId,pos_name AS posName FROM m_merchant_pos WHERE inner_code IN( SELECT inner_code FROM m_merchant_user_rel WHERE app_user_id = #{userId}) AND status = 1
  </select>
</mapper>