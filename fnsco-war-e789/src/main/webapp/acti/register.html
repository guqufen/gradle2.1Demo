<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>数钱吧APP注册页</title>
	<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<script src="js/jquery.min.js" type="text/javascript"></script> 
	<script src="js/setWidth.js" type="text/javascript"></script> 
	<link rel="stylesheet" type="text/css" href="css/reset.css">
	<link rel="stylesheet" type="text/css" href="css/signIn.css">
</head>
<body>
	<div class="login-body">
		<div class="login-input-panel">
			<div class="username-input cl">
				<div class="border cl">
					<div class="icon left">
						<img src="img/6-25-19.png">
					</div>
					<div class="left">
						<input type="text" id="account" name="account" value="" placeholder="请输入注册手机号">
					</div>
				</div>
			</div>
			<div class="v-code cl">
				<div class="left cl">
					<div class="icon left">
						<img src="img/7-5-14.png">
					</div>
					<div class="left">
						<input type="text" id="verycode" name="verycode" value="" placeholder="请输入验证码">
					</div>
					<div class="right">
						<input type="button" class="getCodeBtn" value="获取验证码" onclick="getCode()">
					</div>
				</div>
			</div>
			<div class="password-input cl">
				<div class="border cl">
					<div class="icon left">
						<img src="img/6-25-14.png">
					</div>
					<div class="left">
						<input type="password" id="password" name="password" value="" placeholder="请输入密码">
					</div>
					<div class="right">
						<img src="img/showPass.png" class="passImg" onclick="passShow()" title="显示密码">
					</div>
				</div>
			</div>
			<div class="btn login-btn" id="login_div" onclick="validate()">注册</div>
			<a class="skip" href="download.html">跳过</a>
		</div>
	</div>
</body>
<script src="js/layer/layer.js" type="text/javascript"></script> 
<script type="text/javascript">
function getCode(){
	var account=$("#account").val();
	console.log(account);
	if(!(/^1[3|4|5|8][0-9]\d{4,8}$/.test(account))){
		layer.open({
		    content: '输入的手机号格式不正确'
		    ,skin: 'msg'
		    ,time: 2 //2秒后自动关闭
		  });
		return;
	}
	var params={'oprationType':0,'mobile':account,'deviceId':0};
	$.ajax({
		url:'../h5/user/getValidateCode',
        type:'POST',
        contentType:"application/json",               
 		data:JSON.stringify(params),
        success:function(data){
        	console.log(data);
        	if(data.success){
	        	layer.open({
				    content: '发送成功'
				    ,skin: 'msg'
				    ,time: 2 //2秒后自动关闭
			  	});
			  	Interval();
		  	}else{
			  	layer.open({
				    content: '手机号码已注册'
				    ,skin: 'msg'
				    ,time: 2 //2秒后自动关闭
			  	});
		  	}	
        }
	})
}
function Interval(){
	var time=60;
	var t;
	var interval=setInterval(function(){
		$(".getCodeBtn").val((time--)+'s后重新发送');
		$(".getCodeBtn").attr('disabled',true);
		if(time===0){
			clearInterval(interval);
			$(".getCodeBtn").attr('disabled',false);
			$(".getCodeBtn").val("点击发送");
		}
	},1000)
}
//密码是否可见
function passShow(){
	if($(".passImg").attr('src')=='img/showPass.png'){
		$(".passImg").attr('src','img/hidePass.png');
		$("#password").attr("type","text");
	}else{
		$(".passImg").attr('src','img/showPass.png');
		$("#password").attr("type","password");
	}
}
//注册
function validate(){
	var account=$("#account").val();
	var verycode=$("#verycode").val();
	var password=$("#password").val();
	var entityId=getUrlparam('entityId');
	var params={'mobile':account,'code':verycode,'password':password,'entityInnerCode':entityId,'deviceId':0}
	console.log(params);
	$.ajax({
		url:'../h5/user/register',
        type:'POST',
        contentType:"application/json", 
        data:JSON.stringify(params),
        success:function(data){
        	console.log(data);
        	if(data.success){
	        	layer.open({
				    content: '注册成功，正在跳转APP下载页'
				    ,skin: 'msg'
				    ,time: 2 //2秒后自动关闭
			  	});
			  	setTimeout(function(){
			  		window.location.href="download.html";
			  	},3000)
		  	}else{
		  		layer.open({
				    content: data.message
				    ,skin: 'msg'
				    ,time: 2 //2秒后自动关闭
			  	});
		  	}
		  	
        }
	})
}
//截取url
function getUrlparam(param) {  
    var reg = new RegExp("(^|&)" + param + "=([^&]*)(&|$)", "i");  
    var r = window.location.search.substr(1).match(reg);  
    if (r != null) return unescape(r[2]);  
    return null;  
} 
</script>
</html>