<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>交易统计-法奈昇大数据平台</title>
    <meta name="keywords" content="法奈昇大数据平台">
    <meta name="description" content="法奈昇大数据平台">
    <link rel="shortcut icon" href="favicon.ico">
    <link href="js/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="js/bootstrap/css/font-awesome.css" rel="stylesheet">
    <link href="css/plugins/bootstrap-table/bootstrap-table.min.css" rel="stylesheet">
    <link href="js/bootstrap-datetimepicker/bootstrap-datetimepicker.min.css" rel="stylesheet">
    <link href="css/style.min.css" rel="stylesheet">
    <link href="css/custom.css" rel="stylesheet">
</head>

<body class="gray-bg">
<div class="panel-body animated fadeInRight">
    <div class="panel panel-default">
        <form id="formSearch" class="form-horizontal">
            <div class="form-group" style="margin-top:15px">
                <div class="row col-sm-9">
                    <div class="col-sm-4">
                        <label class="control-label" for="txt_search_id">订单号:</label>
                        <input type="text" class="form-control" id="txt_search_id" name="orderNo" placeholder="请输入需要搜索的订单号">
                    </div>
                    <div class="col-sm-4">
                        <label class="control-label" for="txt_search_name">商户号:</label>
                        <input type="text" class="form-control" id="txt_search_name" name="merId" placeholder="请输入需要搜索的结算商户号"/>
                    </div>
                    <div class="col-sm-4">
                        <label class="control-label" for="txt_search_price">商户名称:</label>
                        <input type="text" class="form-control" id="merName" name="merName" placeholder="请输入需要搜索的商户名称"/>
                    </div>
                    <div class="col-sm-8 query-time">
                        <label class="control-label" for="txt_search_price">发送日期:</label>
                        <input type="text" value="" class="form-control" id="datetimepicker1" name="startSendTime"> -
                        <input type="text" value="" class="form-control" id="datetimepicker2" name="endSendTime">
                    </div>
                    <div class="col-sm-4">
                        <label class="control-label" for="txt_search_price">交易金额:</label>
                        <input type="text" class="form-control" id="txt_search_price" name="amt" placeholder="请输入需要搜索的金额"/>
                    </div>
                </div>
                <div class="col-sm-3" style="text-align: right;">
                    <button type="button" id="btn_query" class="btn btn-primary" onclick="javascript:queryEvent();"><span class="glyphicon glyphicon-search"></span>查询</button>
                    <button type="button" id="btn_reset" class="btn btn-default" onclick="javascript:resetEvent();"><span class="glyphicon glyphicon-refresh"></span>重置</button>
                	<button type="button" id="btn_export" class="btn btn-info" onclick="javascript:exportEvent();"><span class="glyphicon glyphicon-export"></span>导出</button>
                </div>
            </div>
        </form>
        <div class="ibox float-e-margins">
            <div class="ibox-content">
                <div class="row row-lg">
                    <div class="col-sm-12">
                        <table id="table" ></table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
        <!-- end -->
 

<script src="https://cdn.staticfile.org/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
<!-- <script src="js/content.min.js"></script> -->
<script src="js/plugins/bootstrap-table/bootstrap-table.min.js"></script>
<script src="js/plugins/bootstrap-table/bootstrap-table-mobile.min.js"></script>
<script src="js/plugins/bootstrap-table/bootstrap-table-export.js"></script>
<script src="js/plugins/bootstrap-table/tableExport.js"></script>
<script src="js/plugins/bootstrap-table/bootstrap-table-editable.js"></script>
<script src="js/plugins/bootstrap-table/bootstrap-editable.js"></script>
<script src="js/plugins/bootstrap-table/bootstrap-table-zh-CN.min.js"></script>
<script src="js/bootstrap-datetimepicker/bootstrap-datetimepicker.min.js"></script>
<script src="js/bootstrap-datetimepicker/bootstrap-datetimepicker.zh-CN.js"></script>
<script type="text/javascript" src="js/fnsco/common.js"></script>

</body>
<script type="text/javascript">
    $('#table').bootstrapTable({
        search: false, //是否启动搜索栏
        sidePagination:'server',
        url:PROJECT_NAME+'/web/trade/query',
        showRefresh: false,//是否显示刷新按钮
        showPaginationSwitch: false,//是否显示 数据条数选择框(分页是否显示)
        toolbar: '#toolbar',  //工具按钮用哪个容器
        striped: true,   //是否显示行间隔色
        cache: false,   //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
        pagination: true,   //是否显示分页（*）
        sortable: true,   //是否启用排序
        sortOrder: "asc",   //排序方式
        showExport: true, //显示导出按钮
        buttonsAlign:"right",  //按钮位置
        exportDataType: "all",//导出合适条件的所有数据
        exportTypes:['excel'],//只导出excel
        Icons:'glyphicon-export icon-share',
        exportOptions:{  
//             ignoreColumn: [0,1],  //忽略某一列的索引  
            fileName: '商户流水信息',  //文件名称设置  
            worksheetName: '流水列表',  //表格工作区名称  
            tableName: '商户流水信息',  
            excelFileFormat:'xmlss',
            excelstyles: ['background-color', 'color', 'font-size', 'font-weight']
//             onMsoNumberFormat: DoOnMsoNumberFormat  
        },
        pageNumber:1,   //初始化加载第一页，默认第一页
        pageSize: 15,   //每页的记录行数（*）
        pageList: [15, 20, 50, 100], //可供选择的每页的行数（*）
        queryParams:queryParams,
        responseHandler:responseHandler,//处理服务器返回数据
        columns: [{
            field: 'orderNo',
            title: '订单号'
        },{
            field: 'orderIdScan',
            title: '扫码交易的订单号'
        },{
            field: 'merName',
            title: '商户名'
        },{
            field: 'merId',
            title: '结算商户号'
        },{
            field: 'timeStamp',
            title: '交易时间',
            formatter:formatTime
        },{
            field: 'payType',
            title: '支付方式',
            formatter:formatPayType
        },{
            field: 'amt',
            title: '交易金额(元)',
            formatter:formatAmt
        },{
            field: 'orderTime',
            title: '订单时间',
            formatter:formatTime
        },{
            field: 'termId',
            title: '终端号'
        },{
            field: 'batchNo',
            title: '批次号'
        },{
            field: 'sysTraceNo',
            title: '凭证号'
        },{
            field: 'authCode',
            title: '授权码'
        },{
            field: 'source',
            title: '来源',
            formatter:formatSource
        },{
            field: 'createTime',
            title: '创建时间',
            formatter:formatDate
        },{
            field: 'status',
            title: '状态',
            formatter:formatStatus
        }]
    });
    
  //商户注册来源格式处理
    function formatSource(value, row, index){
	    if(!value){
	    	return '-';
	    }
	    else if(value == '00')
    	{
    		return '拉卡拉';
    	}else{
    		return '其他';
    	}	
    }
  //支付方式格式化
  function formatPayType(value, row, index){
	  if(!value){
	    	return '-';
	    }
	  else if(value == '00'){
  		return '刷卡';
  	 }else if(value == '01'){
  		return '二维码';
  	}else{
  		return '其他';
  	}	
  }
  //状态格式化
  function formatStatus(value, row, index){
	  if(!value){
	    	return '-';
	    }
	  else if(value == 0){
		  return '非正常交易';
	  }
	  else if(value == 1){
		  return '正常交易';
	  }
  } 
  //金额格式化
  function formatAmt(value, row, index){
	  if(value){
		  var num = Number(value);
		  return num/100;
	  }
	  return value;
  }
  //时间格式化
  function formatDate(value, row, index){
	  return formatDateUtil(value);
  }
  function formatTime(value, row, index){
	  return formateTimeUtil(value);
  }
  //条件查询按钮事件
    function queryEvent(){
 	   $('#table').bootstrapTable('refresh');
    }
    //重置按钮事件
    function resetEvent(){
 	   $('#formSearch')[0].reset();
    }
  //导出按钮事件
    function exportEvent(){
    	//拼接参数
    			   var orderNo =$('#txt_search_id').val();
     			   var merId=$('#txt_search_name').val();
     			   var merName=$('#merName').val();
     			   var amt=$('#txt_search_price').val();
     			   var startSendTime=$('#datetimepicker1').val();
     			   var endSendTime=$('#datetimepicker2').val();
     			   var url=PROJECT_NAME+'/web/trade/export'+'?orderNo='+orderNo+'&merId='+merId
					+'&merName='+merName+'&amt='+amt
					+'&startSendTime='+startSendTime+'&endSendTime='+endSendTime;
		window.open(url, 'Excel导出');
    }
    window.operateEvents = {
        'click .redact': function (e, value, row, index) {
            alert('You click like action, row: ' + JSON.stringify(row));
        },
        'click .remove': function (e, value, row, index) {
            $table.bootstrapTable('remove', {
                field: 'id',
                values: [row.id]
            });
        }
    };
    function operateFormatter(value, row, index) {
        return [
            '<a class="redact" href="javascript:void(0)" title="编辑">',
            '<i class="glyphicon glyphicon-pencil"></i>',
            '</a>  ',
            '<a class="remove" href="javascript:void(0)" title="删除">',
            '<i class="glyphicon glyphicon glyphicon-trash"></i>',
            '</a>'
        ].join('');
    }
	
  //组装请求参数
    function queryParams(params)
    {
 	   var param ={
 			   currentPageNum : this.pageNumber,
 			   pageSize : this.pageSize,
 			   orderNo :$('#txt_search_id').val(),
 			   merId:$('#txt_search_name').val(),
 			   merName:$('#merName').val(),
 			   amt:$('#txt_search_price').val(),
 			   startSendTime:$('#datetimepicker1').val(),
 			  endSendTime:$('#datetimepicker2').val()
 	   }
 	   return param;
    }
    //处理后台返回数据
    function responseHandler(res) { 
    	unloginHandler(res);
 	    if (res) {
 	        return {
 	            "rows" : res.list,
 	            "total" : res.total
 	        };
 	    } else {
 	        return {
 	            "rows" : [],
 	            "total" : 0
 	        };
 	    }
 	}
    
    /*弹框下一步按钮事件*/
    $(".nextBtn").click(function(){
        $(".nav-tabs li.active").removeClass('active').next().addClass('active');
    })
    $('#datetimepicker1').datetimepicker({
        format: 'yyyy-mm-dd',
        autoclose: true,
        todayBtn: true,
        todayHighlight: true,
        showMeridian: true,
        pickerPosition: "bottom-left",
        language: 'zh-CN',//中文，需要引用zh-CN.js包
        startView: 2,//月视图
        minView: 2//日期时间选择器所能够提供的最精确的时间选择视图
    });
    $('#datetimepicker2').datetimepicker({
        format: 'yyyy-mm-dd',
        autoclose: true,
        todayBtn: true,
        todayHighlight: true,
        showMeridian: true,
        pickerPosition: "bottom-left",
        language: 'zh-CN',//中文，需要引用zh-CN.js包
        startView: 2,//月视图
        minView: 2//日期时间选择器所能够提供的最精确的时间选择视图
    });
</script>
</html>
