<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>杭州法奈昇大数据平台</title>
	<link rel="stylesheet" type="text/css" href="css/chart.css">
</head>
<body>
	<div class="container">
		<div class="container-title">
			杭州法奈昇大数据平台
		</div>
		<div class="box">
			<div class="left-box">
				<div class="china-chart">
					<div id="chart"></div>
					<div class="addres"><img src="img/fnsLogo.png"></div>
				</div>
			</div>
			<div class="right-box">
				<div class="total">
					<div class="total-num">
						<span class="counter" id="total-number"></span>元
					</div>
					<div class="total-count">
						<span class="counter" id="total-count-num"></span>笔
					</div>
				</div>
				<div class="time" id="scrollDiv">
					<div class="scroll" class="scrollText">
						<ul id="scroll-ul">
							
						</ul>
					</div>
				</div>
			</div>
		</div>
		
	</div>
	
</body>
<script type="text/javascript" src="js/echarts.min.js"></script>
<script type="text/javascript" src="js/bmap.js"></script>
<script type="text/javascript" src="js/china.js"></script>
<script type="text/javascript" src="js/chart.js"></script>
<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript" src="js/scroll.js"></script>
<script type="text/javascript" src="js/countup.js"></script>
<script type="text/javascript">
var totalCountNum;
var totalNum;
var amtTot;
var count;
var addRandom;
var addRandom1;
var addAmt=new Number();
var addCount=new Number();
function changeValue(target, startVal, endVal, decimals, duration, options){
     var options = {
      useEasing : true, //使用缓和效果
      useGrouping : true, //使用分组效果
      separator : ',', //分离器，数据够三位，例如100,000
      decimal : '.', //小数点分割，例如：10.00
      prefix : '', //第一位默认数字
      suffix : '' //最后一位默认数字
    };
    var demo = new CountUp(target, startVal, endVal, decimals, duration, options);
    demo.start();
    // target = 目标元素的 ID；
    // startVal = 开始值；
    // endVal = 结束值；
    // decimals = 小数位数，默认值是0；
    // duration = 动画延迟秒数，默认值是2；
}
function getValue(type){
	$.ajax({
		url:'../h5/report/getTradeDataTotle',
		type:'get',
		success:function(data){
			if(!type){
				amtTot=Number(Math.round(data.data.amtTot));
				count=Number(Math.round(data.data.count));
				changeValue('total-number',0,amtTot,0,2);
				changeValue('total-count-num',0,count,0,2);
				totalNum=Number(Math.round(data.data.amtTot));
				totalCountNum=Number(data.data.count);
				// console.log("默认请求:"+totalNum,totalCountNum);
			}else{
				amtTot=Number(Math.round(data.data.amtTot));
				count=Number(Math.round(data.data.count));
				changeValue('total-number',totalNum,amtTot+addAmt,0,2);
				changeValue('total-count-num',totalCountNum,count+addCount,0,2);
				totalNum=amtTot;
				totalCountNum=count;
				// console.log("请求来的值:"+amtTot,count,"显示的值:"+(amtTot+addAmt),count+addCount);
			}
		}
	})
}
function changeVal(){
	newTotalNum=totalNum+parseInt(Math.random()*1000);
	newTotalCountNum=totalCountNum+parseInt(Math.random()*10);
	changeValue('total-number',totalNum,newTotalNum,0,2);
	changeValue('total-count-num',totalCountNum,newTotalCountNum,0,2);
	// $("#scroll-ul").append('<li><div class="card-num">支付宝支付</div><div class="trading"><span class="trading-title">交易金额  ￥</span><span class="trading-num">'+parseInt(Math.random()*1000)+'</span></div></li>');
	addRandom=newTotalNum-totalNum;
	addRandom1=newTotalCountNum-totalCountNum;
	totalNum=newTotalNum;
	totalCountNum=newTotalCountNum;
	addAmt=Number(addRandom+addAmt);
	addCount=Number(addRandom1+addCount);
	// console.log("新增金额："+addAmt,"新增笔数："+addCount);
}
setInterval(function(){
	changeVal();
},3000)	

//格式化时间
Date.prototype.Format = function (fmt) { //author: meizz 
    var o = {
        "M+": this.getMonth() + 1, //月份 
        "d+": this.getDate(), //日 
        "h+": this.getHours(), //小时 
        "m+": this.getMinutes(), //分 
        "s+": this.getSeconds(), //秒 
        "q+": Math.floor((this.getMonth() + 3) / 3), //季度 
        "S": this.getMilliseconds() //毫秒 
    };
    if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
    for (var k in o)
    if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
    return fmt;
}

function getList(){
	$.ajax({
		url:'../h5/report/getTradeDataList',
		type:'get',
		data:{'startDate':'2016-01-01 00:00:00','pageSize':8},
		success:function(data){
			console.log(data);
			for(var i=0;i<data.data.length;i++){
				$("#scroll-ul").append('<li><div class="card-num">'+data.data[i].payType+'</div><div class="trading"><span class="trading-title">交易金额  ￥</span><span class="trading-num">'+data.data[i].amt+'</span></div></li>')
			}
			$("#scrollDiv").textSlider({line:1,speed:500,timer:3000});
		}
	})
}
//设置
$(document).ready(function(){
	getValue();
	getList();
});
setInterval(function(){
	// console.log("重新刷新了");
	getValue("0");
},20000)	
</script>
</html>