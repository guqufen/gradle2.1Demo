<!DOCTYPE html>
<!-- saved from url=(0074)http://wx.51ucar.cn/ucariou_new.php?le=apply_verfiy&tkCode=j_500867&pid=02 -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
	<meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <meta http-equiv="Cache-control" content="public">
    <meta name="format-detection" content="telephone=no">
    <title id="sharetitle">油卡申请</title>
    <meta name="keywords" content="">
    <meta name="description" content="">
    <link type="text/css" rel="stylesheet" href="./files/new_common.css">    <script src="./files/jquery-1.11.1.min.js.下载"></script>
<!--    <script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>-->
    <script src="./files/swipe.js.下载"></script>
    <script src="./files/keyboard.js.下载"></script>
                    </head>
<body data-role="none">

<script>
    var _timer = [];
    /**
     * 延时请求
     * @param id    控制的id(必须为唯一)
     * @param fn    延时执行方法
     * @param wait  延时时间(毫秒)
     * @returns {number}
     */
    function delayLast(id, fn, wait) {
        if (_timer[id]) {
            window.clearTimeout(_timer[id]);
            delete _timer[id];
        }
        return _timer[id] = window.setTimeout(function() {
            fn();
            delete _timer[id];
        }, wait);
    }

	/**
	 * 点击事件延时(延时0.3秒)
     * @param id    控制的id(必须为唯一)
     * @param fn    延时执行方法
     * @param fnBefore 执行方法
     */
    function waitClick(id, fn, fnBefore) {
        fnBefore();
        delayLast(id,fn,300);
    }

</script><link rel="stylesheet" type="text/css" href="./files/apply_verfiy.css">


<section class="wrap">
    <img class="netLogo" src="./files/a_icon5.jpg">
    <p class="btnBox">
        <input class="textWrap" id="telNum" type="tel" placeholder="请输入手机号码" maxlength="11">
        <input class="codeBtn" id="codeBtn" type="button" value="获取验证码" style="border-radius: 0;">
    </p>
    <input class="textWrap" id="codeNum" type="tel" placeholder="请输入验证码" maxlength="6">
    <input class="nextBtn" id="subBtn" type="button" disabled="disabled">
</section>

<script language="javascript" type="text/javascript">
	
/**
 * 页面加载完之后执行
 */
 var innerCode = '';
 var pathName=window.document.location.pathname; 
 var PROJECT_NAME =pathName.substring(0, pathName.substr(1).indexOf('/') + 1);
function GetRequest() {
	var url = location.search; //获取url中"?"符后的字串   
	var theRequest = new Object();
	if (url.indexOf("?") != -1) {
		var str = url.substr(1);
		strs = str.split("&");
		for (var i = 0; i < strs.length; i++) {
			theRequest[strs[i].split("=")[0]] = unescape(strs[i].split("=")[1]);
		}
	}
	return theRequest;
}
    $(function(){
		
    	var request = GetRequest();
    	innerCode=request["innerCode"];console.log('url 参数:'+innerCode);
    	
        $('input').bind('input propertychange', function() {
            checkInputStatus();
        });

        // 检查输入状态
        function checkInputStatus() {
            changeNextStatus(checkInput());
        }

        /**
         * 修改下一步按钮状态
         * @param cNext
         */
        function changeNextStatus(cNext) {
            if (cNext) {
                $("#subBtn").removeAttr('disabled').addClass('nextBtn1');
            }else  {
                $("#subBtn").attr('disabled','disabled').removeClass('nextBtn1');
            }
        }

        // input检查输入
        function checkInput() {
            var telNum = $('#telNum').val();
            var codeNum = $('#codeNum').val();
            return  telNum.length > 0 && codeNum.length > 0;
        }


        //发送手机验证码
        $('#codeBtn').click(function(){
            var ajaxUrl = PROJECT_NAME+'/h5/oil/getNote';
            var m = $('#telNum').val();
            var msg = "";
            if(m == '' || m.length != 11){
                alert("请输入正确的手机号");
                return false;
            }else{
                if(!(/^1[3|4|5|6|7|8|9][0-9]\d{4,8}$/.test(m))){
                    alert("手机号码不正确");
                    $('#telNum').focus();
                    return false;
                }
            }
            $("#codeBtn").attr('disabled','disabled');
            startCount();
            var sj = "send";
            $.ajax({
                url:ajaxUrl,
                type:'get',
                data:{'m':m,'sj':sj},
                dataType:'json',
                success:function(e){
//                     checkInputStatus();
//                     if (e.code == 200) {
// //                        alert(e.message);
//                     } else  {
//                         alert(e.message);
//                         $('#codeNum').val("");
//                     }
                },
                error:function () {
//                     alert("发送验证码失败!");
                    checkInputStatus();
                }
            })
        });
        //提交数据
        $('#subBtn').click(function(){
            var ajaxUrl = PROJECT_NAME+'/h5/oil/next';
            var m = $('#telNum').val();// 手机号
            var v = $('#codeNum').val();// 验证码
            var sj = "after";
//            alert("check code !");
            if(m == '' || m.length != 11)
            {
                alert("请输入正确的手机号");
                $('#telNum').focus();
                return false;
            }
            else{
                if(!(/^1[3|4|5|6|7|8|9][0-9]\d{4,8}$/.test(m))){
                    alert("不是完整的11位手机号或者正确的手机号前七位");
                    $('#telNum').focus();
                    return false;
                }
            }
//
            if ( v.length < 1 )
            {
                alert("请输入验证码！");
                $('#codeNum').val("").focus();
                return false;
            }
            $("#subBtn").attr('disabled', 'disabled');
//            var tkCode = "//";
            $.ajax({
                type: "post",
                url: ajaxUrl,
                data:{"m":m,"v":v,"sj":sj,'innerCode':innerCode},
                dataType: "json"
                }).then(function(res) {
                    checkInputStatus();
                    res = res.data;
                    if (res.code == 200 ) {
                        // 验证成功到欢迎页面
						
                        var res_data = res.data;
						console.log(res_data);
                        if(res_data.href) {
                            window.location.href = res_data.href;
                        }else {
                            window.location.href = PROJECT_NAME+'/h5/oil/index?mobile='+res_data.mobile+"&code="+res_data.code
                            +"&tkCode=j_500867&pid=02";
                        }
                    } else {
                        alert(res.message);
                    }
                },
                function(res){
                    // 请求失败
                    alert("验证请求失败!");
                    checkInputStatus();
                }
            );
        });
    });

    //验证码有效期倒计时
    var i = 60;
    Time = parseInt(i);
    //定义定时器的id
    var listenid;
    var count=Time;
    function startCount(){
        $('#codeBtn').val(count+'s...').attr('disabled','disabled');
        count = count - 1;
        listenid = setTimeout("startCount()",1000)
        if(count < 0){
            count = Time;
            stopCount();
            $('#codeBtn').val('获取验证码').removeAttr('disabled');
        }
    }
    //停止计时
    function stopCount(){
        clearTimeout(listenid);
    }
</script>
<!--	</div>-->
<script type="text/javascript">
    var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
    document.write(unescape("%3Cspan  style='display:none' id='cnzz_stat_icon_1261859351'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s4.cnzz.com/z_stat.php%3Fid%3D1261859351'  type='text/javascript'%3E%3C/script%3E"));
</script><span style="display:none" id="cnzz_stat_icon_1261859351"><a href="http://www.cnzz.com/stat/website.php?web_id=1261859351" target="_blank" title="站长统计">站长统计</a></span><script src="./files/z_stat.php" type="text/javascript"></script><script src="./files/core.php" charset="utf-8" type="text/javascript"></script>
<script type="text/JavaScript">
    //去除ios弹窗默认显示url地址
    window.alert = function(name){
        var iframe = document.createElement("IFRAME");
        iframe.style.display="none";
        iframe.setAttribute("src", 'data:text/plain,');
        document.documentElement.appendChild(iframe);
        window.frames[0].window.alert(name);
        iframe.parentNode.removeChild(iframe);
    }

    if(!document.getElementById("menuTag")){
        /*******
        // 获取“分享到朋友圈”按钮点击状态及自定义分享内容
        wx.config({
            debug: false,
            appId: "wx5a437e2c5051ac20",
            timestamp: "1515401092",
            nonceStr: "gp15DKkKJkwAKTOE",
            signature: "b9d8031e8b42fcec7a9821fbaeace9fdd7663938",
            jsApiList: [
                'hideOptionMenu',
                'onMenuShareAppMessage',
                'chooseImage',
                'uploadImage',
                'hideOptionMenu',
                'openLocation',
                'getLocation'
            ]
        });
        wx.ready(function () {
            wx.hideOptionMenu(); //全部隐藏
        });
         /*********/
    }
</script>
<div style="display: none;"><script src="./files/z_stat(1).php" language="JavaScript"></script><script src="./files/core(1).php" charset="utf-8" type="text/javascript"></script><a href="http://www.cnzz.com/stat/website.php?web_id=1263057696" target="_blank" title="站长统计">站长统计</a></div>

	
</body></html>